{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "./schema/ann.schema.json",
  "title": "Inline Color Annotator Sidecar",
  "description": "Schema for `.ann.json` files consumed by Inline Color Annotator.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "version": { "type": "integer", "minimum": 1, "description": "Producer format version." },
    "file": { "type": "string", "description": "Absolute path to the annotated file (informational)." },
    "legend": {
      "type": "object",
      "description": "Optional legend describing symbols and colors.",
      "additionalProperties": false,
      "properties": {
        "symbols": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "kind": { "type": "string", "description": "Producer-defined classification (e.g., 'onoff')." },
              "color": { "type": "string", "pattern": "^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$", "description": "CSS hex color (#RGB, #RRGGBB, or #RRGGBBAA)." }
            },
            "required": ["color"]
          }
        }
      }
    },
    "ranges": {
      "type": "array",
      "description": "Decorated spans in the target document.",
      "items": { "$ref": "#/definitions/Range" }
    }
  },
  "required": ["ranges"],
  "definitions": {
    "Position": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "line": { "type": "integer", "minimum": 0 },
        "col": { "type": "integer", "minimum": 0 },
        "index": { "type": "integer", "minimum": 0, "description": "Optional absolute character index." }
      },
      "required": ["line", "col"]
    },
    "Range": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "symbol": { "type": "string", "description": "Optional symbol key from legend." },
        "color": { "type": "string", "pattern": "^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$", "description": "CSS hex color used for decoration." },
        "start": { "$ref": "#/definitions/Position" },
        "end": { "$ref": "#/definitions/Position" }
      },
      "required": ["color", "start", "end"]
    }
  }
}

